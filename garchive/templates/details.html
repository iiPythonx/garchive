{% extends "base.html" %}
{% set localCSS = "css/details.css" %}
{% block content %}
    <h2>{{ data["name"] }}</h2>
    <hr>
    <div id="details">
        <div id="details-content">
            {% include "seasons/" + data["id"] + "/season.html" %}
            <div>
                <h3>Gallery</h3>
                <div id="details-gallery-images"></div>
                <div id="details-gallery-buttons">
                    <button onclick="galleryPrevious()"><span>←</span></button>
                    <span id="details-gallery-page"></span>
                    <button onclick="galleryNext()"><span>→</span></button>
                </div>
            </div>
        </div>
        <div id="details-info">
            <div>
                <h3>Description</h3>
                <p>{{ data["description"] }}</p>
            </div>
            <hr>
            <div>
                <h3>Members</h3>
                {% if data["members"] %}
                    <ul>
                        {% for member in data["members"] %}
                            <li><p>{{ member }}</p></li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>None</p>
                {% endif %}
            </div>
            <hr>
            <div>
                <h3>Start - End</h3>
                <p>{{ (data["start"] + " - " + (data["end"] or "Today")) if data["start"] else "N/A" }}</p>
            </div>
            <hr>
            <div>
                <h3>Status</h3>
                <p>{{ "Upcoming" if not data["start"] else ("Active" if not data["end"] else "Inactive") }}</p>
            </div>
            <hr>
            <div>
                <h3>Version</h3>
                <p>{{ data["version"] }}</p>
            </div>
            <hr>
            <div>
                <h3>Accomplishments</h3>
                {% if data["accomplishments"] %}
                    <ul>
                        {% for accomplishment in data["accomplishments"] %}
                        <li><p>{{ accomplishment }}</p></li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>None</p>
                {% endif %}
            </div>
            <hr>
            <div>
                <h3>Modifications</h3>
                {% if data["modifications"] %}
                    <ul>
                        {% for modification in data["modifications"] %}
                            <li>
                                <a href="{{ modification['url'] }}">{{ modification["name"] }} ({{ modification["type"] }})</a>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Vanilla</p>
                {% endif %}
            </div>
            <hr>
            <div>
                <h3>World Download</h3>
                {% if data["download"] %}
                    <a href="/~/seasons/{{ data['id'] }}/download.zip" download="world.zip">Download</a>
                {% else %}
                    <p>Unavailable</p>
                {% endif %}
            </div>
        </div>
    </div>
    <script>
        // Variables
        let galleryCount = 0;
        let galleryElement = document.getElementById("details-gallery-images");
        let galleryImages = "{{ '|'.join(data['gallery']) }}".split("|");
        let galleryLimit = 0;
        let galleryMax = 0;
        let galleryPage = document.getElementById("details-gallery-page");
        let galleryStatic = "/~/seasons/{{ data['id'] }}/gallery/";

        // Functions
        function galleryNext() {
            if((galleryCount + 1) * galleryLimit >= galleryImages.length) return;
            galleryCount++;
            galleyRender();
        }

        function galleryPrevious() {
            if(galleryCount <= 0) return;
            galleryCount--;
            galleryPage.innerText = galleryCount.toString() + " of " + galleryMax.toString();
            galleyRender();
        }

        function galleyRender() {
            galleryElement.replaceChildren();
            galleryPage.innerText = (galleryCount + 1).toString() + " of " + galleryMax.toString();
            let images = galleryImages.slice(galleryCount * galleryLimit, (galleryCount + 1) * galleryLimit);
            if(!images.length) {
                let message = document.createElement("p");
                message.innerText = "The gallery is empty! Come back later~";
                galleryElement.appendChild(message);
                return;
            }
            for(let i = 0; i < images.length; i++) {
                let container = document.createElement("a");
                let image = document.createElement("img");
                let fileName = document.createElement("p");
                container.href = galleryStatic  + images[i].slice(0, -3) + "png";
                image.src = galleryStatic + images[i].slice(0, -3) + "webp";
                fileName.innerText = images[i];
                container.appendChild(image);
                container.appendChild(fileName);
                galleryElement.appendChild(container);
            }
        }

        function galleryResize() {
            let previous = galleryLimit;
            galleryLimit = window.innerWidth < 1000 ? 5 : 20;
            if(previous === galleryLimit) return;
            galleryCount = Math.round(galleryCount * previous / galleryLimit);
            galleryMax = Math.max(Math.ceil(galleryImages.length / galleryLimit), 1);
            galleyRender();
        }

        // Events
        addEventListener("resize", event => galleryResize());

        // Executes
        galleryResize();
    </script>
{% endblock %}
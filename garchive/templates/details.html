{% extends "base.html" %}
{% set localCSS = "css/details.css" %}
{% block content %}
    <h2>{{ data["name"] }}</h2>
    <hr>
    <div id="details">
        <div id="details-content">
            {% include "seasons/" + data["id"] + "/season.html" %}
            <div>
                <h3>Gallery</h3>
                <div id="details-gallery-images"></div>
                <div id="details-gallery-buttons">
                    <button onclick="galleryPreviousPage()"><span>←</span></button>
                    <span id="details-gallery-page"></span>
                    <button onclick="galleryNextPage()"><span>→</span></button>
                </div>
            </div>
        </div>
        <div id="details-info">
            <div>
                <h3>Description</h3>
                <p>{{ data["description"] }}</p>
            </div>
            <hr>
            <div>
                <h3>Members</h3>
                {% if data["members"] %}
                    <ul>
                        {% for member in data["members"] %}
                            <li>{{ member }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>None</p>
                {% endif %}
            </div>
            <hr>
            <div>
                <h3>Start - End</h3>
                <p>{{ (data["start"] + " - " + (data["end"] or "Today")) if data["start"] else "N/A" }}</p>
            </div>
            <hr>
            <div>
                <h3>Status</h3>
                <p>{{ "Upcoming" if not data["start"] else ("Active" if not data["end"] else "Inactive") }}</p>
            </div>
            <hr>
            <div>
                <h3>Version</h3>
                <p>{{ data["version"] }}</p>
            </div>
            <hr>
            <div>
                <h3>Accomplishments</h3>
                {% if data["accomplishments"] %}
                    <ul>
                        {% for accomplishment in data["accomplishments"] %}
                        <li>{{ accomplishment }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>None</p>
                {% endif %}
            </div>
            <hr>
            <div>
                <h3>Modifications</h3>
                {% if data["modifications"] %}
                    <ul>
                        {% for modification in data["modifications"] %}
                            <li>
                                <a href="{{ modification['url'] }}">{{ modification["name"] }} ({{ modification["type"] }})</a>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Vanilla</p>
                {% endif %}
            </div>
            <hr>
            <div>
                <h3>World Download</h3>
                {% if data["download"] %}
                    <a href="/~/seasons/{{ data['id'] }}/download.zip" download="world.zip">Download</a>
                {% else %}
                    <p>Unavailable</p>
                {% endif %}
            </div>
        </div>
    </div>
    <script>
        // Variables
        let galleryCount = 0;
        let galleryElement = document.getElementById("details-gallery-images");
        let galleryImages = "{{ '|'.join(data['gallery']) }}".split("|");
        let galleryMax = Math.max(Math.ceil(galleryImages.length / 15), 1);
        let galleryPage = document.getElementById("details-gallery-page");
        galleryRenderPage();

        // Functions
        function galleryRenderPage() {
            galleryElement.replaceChildren();
            galleryPage.innerText = (galleryCount + 1).toString() + " of " + galleryMax.toString();
            let images = galleryImages.slice(galleryCount * 15, (galleryCount + 1) * 15);
            if(!images.length) {
                let message = document.createElement("p");
                message.innerText = "The gallery is empty! Come back later~";
                galleryElement.appendChild(message);
                return;
            }
            for(let i = 0; i < images.length; i++) {
                let container = document.createElement("a");
                let image = document.createElement("img");
                let fileName = document.createElement("p");
                container.href = image.src = "/~/seasons/{{ data['id'] }}/gallery/" + images[i];
                fileName.innerText = images[i];
                container.appendChild(image);
                container.appendChild(fileName);
                galleryElement.appendChild(container);
            }
        }

        function galleryPreviousPage() {
            if(galleryCount <= 0) return;
            galleryCount--;
            galleryPage.innerText = galleryCount.toString() + " of " + galleryMax.toString();
            galleryRenderPage();
        }

        function galleryNextPage() {
            if((galleryCount + 1) * 15 >= galleryImages.length) return;
            galleryCount++;
            galleryRenderPage();
        }
    </script>
{% endblock %}